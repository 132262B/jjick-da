<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="app.jjickda.api.exam.repository.ExamRepository">

    <!-- 시험문제 조회  -->
    <select id="selectQuestionList" resultType="questionDto">
        SELECT TEQ.IDX AS QUESTION_IDX
             , TEM.FILE_ID
             , TES.IDX AS SUBJECT_IDX
             , TES.SUBJECT_NAME
             , TEQ.QUESTION_NAME
          FROM TB_EXAM_QUESTION AS TEQ
          LEFT JOIN TB_EXAM_MULTIMEDIA AS TEM
            ON TEQ.MULTIMEDIA_IDX = TEM.IDX
          LEFT JOIN TB_EXAM_SUBJECT TES
            ON TEQ.SUBJECT_IDX = TES.IDX
         WHERE TEQ.EXAM_IDX IN ( <foreach collection="choiceInfoDto.examIdxArray" item="item" index="index" separator=",">
                                  #{item}
                                 </foreach>
                               )
           AND TEQ.SUBJECT_IDX = #{subjectIdx}
    </select>

    <!-- 시험과목 테이블에서 과목 별 문항 개수 조회 -->
    <select id="selectSubjectQuestionCnt" resultType="long">
        SELECT TES.SUBJECT_QUESTION_CNT
          FROM TB_EXAM_SUBJECT TES
         WHERE USE_STATUS = 1
           AND TES.IDX = #{subjectIdx}
    </select>

    <!-- 선지 정보 조회 -->
    <select id="selectOptionsList" resultType="optionsDto">
        SELECT IDX
             , QUESTION_IDX
             , OPTIONS_NUMBER
             , OPTIONS_CONTENT
          FROM TB_EXAM_OPTIONS TEO
         WHERE TEO.QUESTION_IDX  IN ( <foreach collection="questionListDto" item="item" index="index" separator=",">
                                        #{item.questionIdx}
                                      </foreach>
        )
         ORDER BY QUESTION_IDX,OPTIONS_NUMBER ASC
    </select>

    <!-- 진행중인 시험 정보 조회 -->
    <select id="selectOngoingExamInfo" resultType="ongoingExamInfoDto">
        SELECT SUB_CATEGORY_NAME
             , OPTIONS_CNT
          FROM TB_EXAM_SUB_CATEGORY TESC
         WHERE USE_STATUS = 1
           AND IDX = #{subCtgIdx}
    </select>

</mapper>