<!doctype html>
<html lang="kr">
<th:block th:replace="fragments/admin/head :: adminHeadFragment"></th:block>
<script>
      let index = 1;

      $(function(){
        $.ajax({
              type:"POST",
              url:"/api/admin/get-main-category",
              dataType:"json"
            }).done(function(data){
              let dataList = "";
              for(let i of data.data){
                dataList += "<option data-value='" + i.idx + "' value='" + i.mainCategoryName + "' />"
              }
              $("#data_list").append(dataList);
            }).fail(function(){
            })

      $("#main_ctg_name").on("change",function(){
      let main_ctg_name = $("#main_ctg_name").val();
      let mainIdx = $("#data_list [value='" + main_ctg_name + "']").data("value");
      if(mainIdx == "" || mainIdx == null){
        $("#data_list2").html("");
        $("#data_list3").html("");
        $("#sub_ctg_name").val("");
        $("#subject_name").val("");
      }else{
            $.ajax({
                  type:"POST",
                  url:"/api/admin/get-sub-category",
                  data:{"mainIdx":mainIdx},
                  dataType:"json"
            }).done(function(data){
              let subDataList = "";
              for(let i of data.data){
                subDataList += "<option data-value='" + i.idx + "' value='" + i.subCategoryName + "' />"
              }
              $("#data_list2").html(subDataList);
            }).fail(function(){
            })
      }
    })

  $("#sub_ctg_name").on("change",function(){
      let sub_ctg_name = $("#sub_ctg_name").val();
      let subIdx = $("#data_list2 [value='" + sub_ctg_name + "']").data("value");
      if(subIdx == "" || subIdx == null){
        $("#data_list3").html("");
        $("#subject_name").val("");
      }else{
            $.ajax({
                  type:"POST",
                  url:"/api/admin/get-subject-category",
                  data:{"subIdx":subIdx},
                  dataType:"json"
            }).done(function(data){
              let subjectDataList = "";
              for(let i of data.data){
                subjectDataList += "<option data-value='" + i.idx + "' value='" + i.subjectName + "' />"
              }
              $("#data_list3").html(subjectDataList);
            }).fail(function(){
            })
      }
    })

        $("#question_count").on("change",function(){
          let count = $("#question_count").val()
          if(count == "5"){
            for(let i = 1; i<=index; i++){
              $("#No" + i).append(
                "<div class='col-md-12' id='choice'>"+
                  "<div id='choice_index'>5.</div>"+
                  "<input type='radio' name='correct_check_"+i+"' id='correct_check' value='check_5'>"+
                  "<textarea id='question' class='form-control' name='' rows='2' placeholder='보기' required></textarea>"+
                  "</div>"
              )
            }
          }
          if(count == "4"){
            for(let i = 1; i<=index; i++){
              $("#No" + i).children("#choice").last().remove();
            }
          }

        })


          $("#plus_icon").on("click",function(){
            index++;
            let html_first = "";
            let html_middle = "";
            let html_end = "";
            var question_count = $("#question_count").val()
            html_first += "<div class='question_data_" + index + " row gy-4' id='add'>"+
                  "<div class='col-md-12'>"+
                    "<div class='accordion-item'>"+
                      "<input id='question_subject' type='text' class='form-control' name='subject' placeholder='No "+index+".' required>"+
                      "<button id='hide_button' class='accordion-button collapsed' type='button' data-bs-toggle='collapse' data-bs-target='#No"+index+"' />"+
                    "</div>"+
                  "</div>"+
                  "<div id='No"+index+"' class='accordion-collapse collapse' data-bs-parent='#faqlist'>"+
                    "<div class='filebox'>"+
                      "<input class='upload-name form-control' id='upload_name_"+index+"' readonly placeholder='첨부파일'>"+
                      "<label for='file"+index+"'>파일찾기</label>"+
                      "<input type='file' id='file"+index+"'>"+
                      "</div>"+
                      "<div class='img_wrap'>"+
                        "<img class='mt-5' id='img"+index+"' />"+
                        "</div>"
            for(var i=1; i<=question_count;i++){
          html_middle +=    "<div class='col-md-12' id='choice'>"+
                                "<div id='choice_index'>"+i+".</div>"+
                                "<input type='radio' name='correct_check_"+index+"' id='correct_check' value='check_"+i+"'>"+
                                "<textarea id='question' class='form-control' name='' rows='2' placeholder='보기' required></textarea>"+
                            "</div>"

        }
        html_end ="</div></div>"

        let html = html_first+html_middle+html_end;
        $("#plus_icon").before(html);

          })

      })
$(function(){
    $(document).on("click","#minus_icon",function(){
      $(this).prev().prev("#add:not(:first-child)").remove();
      index--;
      if(index < 1){
        index = 1;
      }
      })
})
  </script>
<script>
    $(document).ready(function() {
        $(document).on("change", "input[type=file]", function(e){
          var file_id_name = $(this).attr('id');
          var file_index = file_id_name.substr(4,4);
          var fileName = $("#"+file_id_name).val();
          $("#upload_name_"+file_index).val(fileName);
          var files = e.target.files;
          var filesArr = Array.prototype.slice.call(files);

          var reg = /(.*?)\/(jpg|jpeg|png)$/;

          filesArr.forEach(function(f) {
              if (!f.type.match(reg)) {
                  alert("이미지 확장자가 아닙니다.");
                  $("#img").attr("src", null);
                  return;
              }

              sel_file = f;

              var reader = new FileReader();
              reader.onload = function(e) {
                  $("#img"+file_index).attr("src", e.target.result);
              }
              reader.readAsDataURL(f);
          });
          })
      });
  </script>
  <body>
  <th:block th:replace="fragments/admin/header :: adminHeaderFragment"></th:block>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

  <section id="contact" class="contact">
      <div class="container" data-aos="fade-up" data-aos-duration="1000">
          <header class="section-header">
              <h2>문제 등록</h2>
              <p>문항 등록</p>
          </header>
          <div class="row gy-4">
                  <div class="row gy-4">
                      <div id="select_flex">
                          <div class="col-md-4" id="selects">
                              <input type="text" class="form-control" id="main_ctg_name" list="data_list" placeholder="메인 카테고리 선택">
                              <datalist id="data_list" class="col-md-6">
                              </datalist>
                          </div>
                          <div class="col-md-4" id="selects">
                              <input type="text" class="form-control" id="sub_ctg_name" list="data_list2" placeholder="서브 카테고리 선택">
                              <datalist id="data_list2" class="col-md-6">
                              </datalist>
                          </div>
                          <div class="col-md-4" id="selects">
                              <input type="text" class="form-control" id="subject_name" list="data_list3" placeholder="과목 선택">
                              <datalist id="data_list3" class="col-md-6">
                              </datalist>
                          </div>
                          <div class="col-md-4" id="selects">
                              <input type="text" id="select" class="form-control" placeholder="문항 제목">
                          </div>
                          <div class="col-md-4" id="selects">
                              <select class="form-control" id="question_count">
                                  <option value="4" selected>4</option>
                                  <option value="5">5</option>
                              </select>
                          </div>
                      </div>
                  </div>
                  <div class="accordion accordion-flush" id="faqlist">
                      <div class="question_data_1 row gy-4" id="add">
                          <div class="col-md-12">
                              <div class="accordion-item">
                                  <input id="question_subject" type="text" class="form-control" name="subject" placeholder="No 1." required>
                                  <button id="hide_button" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#No1" />
                              </div>
                          </div>
                          <div id="No1" class="accordion-collapse collapse" data-bs-parent="#faqlist">
                              <div class="filebox">
                                  <input class="upload-name form-control" id="upload_name_1" readonly placeholder="첨부파일">
                                  <label for="file1">파일찾기</label>
                                  <input type="file" id="file1">
                              </div>
                              <div class="img_wrap">
                                  <img class="mt-5" id="img1" />
                                  </div>
                              <div class="col-md-12" id="choice">
                                  <div id="choice_index">1.</div>
                                  <input type="radio" name="correct_check_1" id="correct_check" value="check_1">
                                  <textarea id="question" class="form-control" name="" rows="2" placeholder="보기" required></textarea>
                              </div>
                              <div class="col-md-12" id="choice">
                                  <div id="choice_index">2.</div>
                                  <input type="radio" name="correct_check_1" id="correct_check" value="check_2">
                                  <textarea id="question" class="form-control" name="" rows="2" placeholder="보기" required></textarea>
                              </div>
                              <div class="col-md-12" id="choice">
                                  <div id="choice_index">3.</div>
                                  <input type="radio" name="correct_check_1" id="correct_check" value="check_3">
                                  <textarea id="question" class="form-control" name="" rows="2" placeholder="보기" required></textarea>
                              </div>
                              <div class="col-md-12" id="choice">
                                  <div id="choice_index">4.</div>
                                  <input type="radio" name="correct_check_1" id="correct_check" value="check_4">
                                  <textarea id="question" class="form-control" name="" rows="2" placeholder="보기" required></textarea>
                              </div>
                          </div>
                      </div>
                      <i id="plus_icon" class="bi bi-folder-plus"></i>
                      <i id="minus_icon" class="bi bi-folder-minus"></i>
                  </div>
                  <div class="col-md-12 text-center">
                      <button id="button5" class="regist_button m-2" type="button">작성</button><button id="button5" class="preview_button m-2" type="button">미리보기</button>
                  </div>
          </div>
      </div>
  </section>
<script>
$(function(){
    let data = {};




})
</script>


  </body>
</html>